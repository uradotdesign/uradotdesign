---
import { getCurrentLanguage } from "../lib/i18n";

const currentLang = getCurrentLanguage(Astro.url);
const currentPath = Astro.url.pathname;

// Remove language prefix if it exists
const pathWithoutLang = currentPath.replace(/^\/(en|de)/, "") || "/";

const currentLanguageName = currentLang === "en" ? "ENGLISH" : "GERMAN";

const languages = [
  { code: "en", name: "ENGLISH", path: `/en${pathWithoutLang}` },
  { code: "de", name: "GERMAN", path: `/de${pathWithoutLang}` },
];
---

<details class="relative group" id="lang-dropdown">
  <summary
    id="lang-toggle"
    class="text-sm font-medium font-mono transition-opacity flex items-center gap-1 cursor-pointer list-none marker:hidden focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[var(--color-border)]"
    aria-haspopup="true"
  >
    <span>{currentLanguageName}</span>
    <svg
      class="w-3 h-3 transition-transform duration-300 group-open:-rotate-180"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      aria-hidden="true"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M19 9l-7 7-7-7"></path>
    </svg>
  </summary>
  <div
    role="menu"
    aria-labelledby="lang-toggle"
    class="absolute top-full right-0 mt-2 w-36 z-[60] opacity-0 invisible group-open:opacity-100 group-open:visible group-open:pointer-events-auto transition-all duration-200 origin-top-right"
  >
    <div
      class="lang-dropdown-menu rounded-lg shadow-lg border border-[var(--color-border)] py-2 backdrop-blur-xl bg-white/95 dark:bg-gray-900/95 overflow-hidden font-mono"
    >
      {
        languages.map((lang) => (
          <a
            href={lang.path}
            role="menuitem"
            class:list={[
              "block px-4 py-2 text-sm transition-colors cursor-pointer focus:outline-none",
              currentLang === lang.code
                ? "font-bold text-gray-900 dark:text-white bg-gray-100 dark:bg-gray-800"
                : "text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 hover:text-gray-900 dark:hover:text-white focus-visible:bg-gray-100 dark:focus-visible:bg-gray-800",
            ]}
            aria-label={`Switch to ${lang.name}`}
            aria-current={currentLang === lang.code ? "true" : undefined}
          >
            {lang.name}
          </a>
        ))
      }
    </div>
  </div>
</details>
