---
import { getCurrentLanguage } from "../../lib/i18n";
import { t } from "../../lib/translations";

interface Props {
  sectionTitle?: string;
  approaches: Array<{
    title: string;
    description: string;
    borderAnimation?: "friction" | "teamwork" | "strength";
  }>;
}

const currentLang = getCurrentLanguage(Astro.url);
const defaultTitle = await t("approach.title", currentLang, "APPROACH");
const { sectionTitle = defaultTitle, approaches } = Astro.props;
---

<section class="approach-section py-32">
  <div class="container mx-auto px-6">
    <!-- Section Title -->
    <div class="mb-16 flex items-center gap-6">
      <h2
        class="text-[12px] sm:text-xs font-mono uppercase text-foreground/70 whitespace-nowrap"
      >
        {sectionTitle}
      </h2>
      <div class="flex-1 h-px bg-[var(--color-border)]"></div>
    </div>

    <!-- Approach Cards Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 md:gap-24 gap-4 max-w-full">
      {
        approaches.map((approach, index) => (
          <div
            class={`approach-card approach-${approach.borderAnimation || "friction"}`}
          >
            <div class="approach-content">
              <h3 class="approach-title text-4xl md:text-6xl font-display text-foreground transition-colors duration-300">
                {approach.title}
              </h3>
              <p class="text-base leading-relaxed text-muted-foreground mt-8">
                {approach.description}
              </p>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  .approach-section {
    position: relative;
  }

  .approach-card {
    position: relative;
  }

  .approach-content {
    position: relative;
  }

  .approach-title {
    position: relative;
    padding-right: 25%; /* Increased padding to force text wrapping while keeping border at edge */
    margin-bottom: 0;
    display: block;
    line-height: 1.1;
  }

  /* Persistent border on the right side of title */
  .approach-title::after {
    content: "";
    position: absolute;
    right: 0;
    top: -0.2em;
    bottom: -0.2em;
    width: 2px;
    background: var(--color-foreground);
    opacity: 1;
  }

  /* Animated expanding border (expands to the left on hover) */
  .approach-title::before {
    content: "";
    position: absolute;
    right: 2px;
    top: -0.2em;
    bottom: -0.2em;
    width: 0;
    background: var(--color-foreground);
  }

  /* Keyframes for Friction - Bumpy back and forth with opposite movement */
  @keyframes friction-bump {
    0% {
      width: 0;
    }
    5% {
      width: 20px;
    }
    13% {
      width: 45px;
    }
    17% {
      width: 35px;
    }
    25% {
      width: 70px;
    }

    /* Opposite movement - shrink back */
    30% {
      width: 60px;
    }
    35% {
      width: 40px;
    }
    40% {
      width: 50px;
    }
    45% {
      width: 30px;
    }

    /* Resume forward */
    50% {
      width: 55px;
    }
    55% {
      width: 75px;
    }
    60% {
      width: 65px;
    }
    65% {
      width: 95px;
    }
    70% {
      width: 85px;
    }
    75% {
      width: 110px;
    }
    80% {
      width: 120px;
    }
    85% {
      width: 115px;
    }
    90% {
      width: 120px;
    }
    95% {
      width: 100px;
    }
    100% {
      width: 120px;
    }
  }

  /* Animation: Friction - Inconsistent bumpy back-and-forth */
  .approach-card.approach-friction:hover .approach-title::before {
    animation: friction-bump 2s ease-in-out forwards;
  }

  /* Keyframes for Teamwork - Elastic slingshot pull-back and launch */
  @keyframes teamwork-elastic {
    0% {
      width: 0;
      transform: scaleX(1);
      transform-origin: right;
    }

    /* Pull back (gathering the team) */
    15% {
      width: 15px;
      transform: scaleX(0.7);
      transform-origin: right;
    }

    /* More pull back tension */
    25% {
      width: 20px;
      transform: scaleX(0.5);
      transform-origin: right;
    }

    /* Maximum tension */
    35% {
      width: 25px;
      transform: scaleX(0.4);
      transform-origin: right;
    }

    /* Release! Rapid expansion with overshoot */
    50% {
      width: 130px;
      transform: scaleX(1.15);
      transform-origin: right;
    }

    /* Bounce back slightly */
    60% {
      width: 110px;
      transform: scaleX(0.95);
      transform-origin: right;
    }

    /* Second bounce forward */
    70% {
      width: 125px;
      transform: scaleX(1.05);
      transform-origin: right;
    }

    /* Settle */
    80% {
      width: 118px;
      transform: scaleX(0.98);
      transform-origin: right;
    }

    /* Final position */
    100% {
      width: 120px;
      transform: scaleX(1);
      transform-origin: right;
    }
  }

  /* Animation: Teamwork - Elastic slingshot */
  .approach-card.approach-teamwork:hover .approach-title::before {
    animation: teamwork-elastic 2s cubic-bezier(0.68, -0.55, 0.265, 1.55)
      forwards;
  }

  /* Keyframes for Strength - Loading bar with spring action per block */
  @keyframes strength-load {
    0% {
      width: 0;
    }
    5% {
      width: 0;
    }
    10% {
      width: 35px;
    } /* Overshoot */
    12% {
      width: 28px;
    } /* Spring back */
    15% {
      width: 30px;
    } /* Settle */

    20% {
      width: 30px;
    }
    25% {
      width: 65px;
    } /* Overshoot */
    27% {
      width: 58px;
    } /* Spring back */
    30% {
      width: 60px;
    } /* Settle */

    35% {
      width: 60px;
    }
    40% {
      width: 95px;
    } /* Overshoot */
    42% {
      width: 88px;
    } /* Spring back */
    45% {
      width: 90px;
    } /* Settle */

    50% {
      width: 90px;
    }
    55% {
      width: 125px;
    } /* Overshoot */
    57% {
      width: 118px;
    } /* Spring back */
    60% {
      width: 120px;
    } /* Settle */

    75% {
      width: 120px;
    } /* Hold full */
    80% {
      width: 120px;
    }
    85% {
      width: 60px;
    } /* Quick drain */
    90% {
      width: 20px;
    }
    95% {
      width: 0;
    }
    100% {
      width: 0;
    }
  }

  /* Animation: Strength - Loading bar with spring per segment */
  .approach-card.approach-strength:hover .approach-title::before {
    animation: strength-load 3s ease-out forwards;
  }

  /* Divider between cards (visible on desktop only) */
  .approach-divider {
    position: absolute;
    right: -2rem;
    top: 0;
    bottom: 0;
    width: 1px;
    background: var(--color-border);
  }

  /* Mobile: Stack cards without dividers */
  @media (max-width: 768px) {
    .approach-card {
      border-bottom: 1px solid var(--color-border);
      padding-bottom: 3rem;
      margin-bottom: 3rem;
    }

    .approach-card:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .approach-title {
      padding-right: 2rem;
    }
  }

  /* Touch device support */
  @media (hover: none) and (pointer: coarse) {
    .approach-card.approach-friction:active .approach-title::before {
      animation: friction-bump 2s ease-in-out infinite;
      animation-direction: alternate;
    }

    .approach-card.approach-teamwork:active .approach-title::before {
      animation: teamwork-elastic 3s ease-in-out infinite;
      animation-direction: alternate;
    }

    .approach-card.approach-strength:active .approach-title::before {
      animation: strength-load 3s ease-out infinite;
      animation-direction: alternate;
    }
  }
</style>
